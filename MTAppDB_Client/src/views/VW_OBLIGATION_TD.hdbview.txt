VIEW "VW_OBLIGATION_TD" ( "OBLIGATION_ID",
	 "DATASET_ID",
	 "TAX_PERIOD_ID",
	 "VERSION",
	 "OBLIGATION_TYPE_ID",
	 "OBLIGATION_STATUS_ID",
	 "OBLIGATION_NAME",
	 "IS_NIL_FILING",
	 "ACCOUNT_COUNT",
	 "EXCEPTION_COUNT",
	 "FILING_REQUIREMENT_ID",
	 "REVIEW_PACKAGE_ID",
	 "TAX_PERIOD_NAME",
	 "TAX_PERIOD_CODE",
	 "TAX_YEAR",
	 "TAX_PERIOD_START",
	 "TAX_PERIOD_END",
	 "IS_FATCA_VISIBLE",
	 "IS_CRS_VISIBLE",
	 "IS_DEFAULT_VIEW",
	 "IS_DEFINE_OBLIGATION",
	 "SCOPE_OBLIGATION_STATUS_ID",
	 "SCOPE_OBLIGATION_STATUS_NAME",
	 "FI_ID",
	 "ENTITY_ID",
	 "IS_SUPPRESS_ENTITY",
	 "IS_SUPPRESS_ACCOUNT" ) AS SELECT
	 OBLIGATION."OBLIGATION_ID",
	 OBLIGATION."DATASET_ID",
	 OBLIGATION."TAX_PERIOD_ID",
	 OBLIGATION."VERSION",
	 OBLIGATION."OBLIGATION_TYPE_ID",
	 OBLIGATION."OBLIGATION_STATUS_ID",
	 OBLIGATION."OBLIGATION_NAME",
	 OBLIGATION."IS_NIL_FILING",
	 OBLIGATION."ACCOUNT_COUNT",
	 OBLIGATION."EXCEPTION_COUNT",
	 OBLIGATION."FILING_REQUIREMENT_ID",
	 OBLIGATION."REVIEW_PACKAGE_ID",
	 OBLIGATION_SCOPE."TAX_PERIOD_NAME",
	 OBLIGATION_SCOPE."TAX_PERIOD_CODE",
	 OBLIGATION_SCOPE."TAX_YEAR",
	 OBLIGATION_SCOPE."TAX_PERIOD_START",
	 OBLIGATION_SCOPE."TAX_PERIOD_END",
	 OBLIGATION_SCOPE."IS_FATCA_VISIBLE",
	 OBLIGATION_SCOPE."IS_CRS_VISIBLE",
	 OBLIGATION_SCOPE."IS_DEFAULT_VIEW",
	 OBLIGATION_SCOPE."IS_DEFINE_OBLIGATION",
	 OBLIGATION_SCOPE."OBLIGATION_STATUS_ID" AS "SCOPE_OBLIGATION_STATUS_ID",
	 OBLIGATION_SCOPE."OBLIGATION_STATUS_NAME" AS "SCOPE_OBLIGATION_STATUS_NAME",
	 FI."FI_ID",
	 FI."ENTITY_ID",
	 IFNULL(ENTITY_SUPPRESSION."IS_SUPPRESS_ENTITY",
	0) AS "IS_SUPPRESS_ENTITY",
	 IFNULL(ENTITY_SUPPRESSION."IS_SUPPRESS_ACCOUNT",
	0) AS "IS_SUPPRESS_ACCOUNT" 
FROM "OBLIGATION" OBLIGATION 
LEFT JOIN "VW_OBLIGATION_SCOPE" OBLIGATION_SCOPE ON OBLIGATION."TAX_PERIOD_ID" = OBLIGATION_SCOPE."TAX_PERIOD_ID" 
LEFT JOIN "FI" FI ON FI."FI_ID" = OBLIGATION."FI_ID" 
AND FI."STATUS_ID" = 1 
LEFT JOIN "ENTITY_SUPPRESSION" ENTITY_SUPPRESSION ON FI."ENTITY_ID" = ENTITY_SUPPRESSION."ENTITY_ID" 
AND OBLIGATION."TAX_PERIOD_ID" = ENTITY_SUPPRESSION."TAX_PERIOD_ID" 
AND OBLIGATION."OBLIGATION_TYPE_ID" = ENTITY_SUPPRESSION."OBLIGATION_TYPE_ID" 
AND ENTITY_SUPPRESSION."STATUS_ID" = 1 
WHERE OBLIGATION."STATUS_ID" = 1 WITH ASSOCIATIONS( JOIN "FI_ACCOUNT" AS "FI_ACCOUNT" ON "FI_ID" = FI_ACCOUNT."FI_ID" 
	AND ( ( "OBLIGATION_STATUS_ID" > 5 
			AND "OBLIGATION_ID" = FI_ACCOUNT."LOCK_OBLIGATION_ID" 
			AND FI_ACCOUNT."STATUS_ID" = 14 ) 
		OR ( "OBLIGATION_STATUS_ID" < 6 
			AND FI_ACCOUNT."EFF_FROM_DATE" = "TAX_PERIOD_END" 
			AND FI_ACCOUNT."STATUS_ID" = 16 
			AND "IS_SUPPRESS_ACCOUNT" <> 1 ) ),
	 JOIN "OBLIGATION_TYPE" AS "OBLIGATION_TYPE" ON "OBLIGATION_TYPE_ID" = OBLIGATION_TYPE."OBLIGATION_TYPE_ID" 
	AND OBLIGATION_TYPE."STATUS_ID" = 1,
	 JOIN "OBLIGATION_REVIEW_PACKAGE" AS "OBLIGATION_REVIEW_PACKAGE" ON "REVIEW_PACKAGE_ID" = OBLIGATION_REVIEW_PACKAGE."OBLIGATION_REVIEW_PACKAGE_ID" 
	AND OBLIGATION_REVIEW_PACKAGE."STATUS_ID" = 1,
	 JOIN "ENTITY" AS "ENTITY" ON "ENTITY_ID" = ENTITY."ENTITY_ID" 
	AND ( ( "OBLIGATION_STATUS_ID" > 5 
			AND "OBLIGATION_ID" = ENTITY."LOCK_OBLIGATION_ID" 
			AND ENTITY."STATUS_ID" = 14 ) 
		OR ( "OBLIGATION_STATUS_ID" < 6 
			AND ENTITY."EFF_FROM_DATE" = "TAX_PERIOD_END" 
			AND ENTITY."STATUS_ID" = 16 ) ),
	 JOIN "OBLIGATION_STATUS" AS "OBLIGATION_STATUS" ON "OBLIGATION_STATUS_ID" = OBLIGATION_STATUS."OBLIGATION_STATUS_ID" 
	AND OBLIGATION_STATUS."STATUS_ID" = 1,
	 JOIN "DATASET" AS "DATASET" ON "DATASET_ID" = DATASET."DATASET_ID" 
	AND DATASET."STATUS_ID" <> 6,
	 JOIN "FILING_REQUIREMENT" AS "FILING_REQUIREMENT" ON "FILING_REQUIREMENT_ID" = FILING_REQUIREMENT."FILING_REQUIREMENT_ID" 
	AND FILING_REQUIREMENT."STATUS_ID" = 1) WITH READ ONLY